---
title: "Lesson 7 - Summary exercise" 
output:
  learnr::tutorial:
    progressive: true
    allow_skip: false
runtime: shiny_prerendered  

description: >
 <div style='direction: rtl;'>
 תרגיל מלווה המיישם את החומר שנלמד במהלך הסמסטר. בתרגיל ננתח נתונים אמיתיים מניסוי שכלל מטלת סטרופ ומספר שאלונים, מא ועד ת.
 </div>

editor_options: 
  markdown: 
    wrap: 72
---

```{=html}
<style>
h1, h2, h3, h4, h5, h6 {
  direction: rtl;
}
p {
  direction: rtl;
}

.text-block1 {
  direction: rtl;       /* Set text direction to right-to-left */
  text-align: right;
  background-color: #f0f0f0; /* Light grey background */
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #ddd; /* Light border */
  margin: 10px 0; /* Space around the block */
  
</style>
```

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
library(Rcourse)

tutorial_options(
  exercise.timelimit = 60,
  # A simple checker function that just returns the message in the check chunk
  exercise.checker = function(check_code, ...) {
    list(
      message = eval(parse(text = check_code)),
      correct = logical(0),
      type = "info",
      location = "append"
    )
  }
)

knitr::opts_chunk$set(error = TRUE)
gradethis::gradethis_setup()
```


## תרגיל - סינון וניתוח נתונים


השיעור שלפניכם כולל תרגיל המסכם את החומר שנלמד בסמסטר א'. קובץ השיעור ילווה אתכם בניתוח, בו נעבד נתונים אמיתיים ממטלה קוגנטיבית שנערכה במספר מעבדות. הניתוח יכלול את כל השלבים בניתוח נתונים אמיתיים, מהסינון ובקרת איכות הנתונים ועד להקפת תרשימים עבור התוצאות ובמהלכו ניישם את מרבית החומר שנלמד במהלך הסמסטר.

את התרגיל עצמו מומלץ לפתור בסביבת העבודה בRstudio, במקביל לקריאת קובץ זה.

בהצלחה!


### תיאור הנתונים

הנתונים איתם נעבוד כוללים 2 טבלאות - טבלה אחת המכילה את תשובותיהם של הנבדקים בשאלון *** וטבלה נוספת המכילה פירוט של תגובות הנבדקים וזמני התגובה שלהם במטלת "סטרופ". במטלה זו נבדקים מתבקשים לציין את הצבע של מילים שונות המופיעות על המסך, תוך התעלמות מהתוכן שלהן. כשהמילה שמופיעה תואמת לצבע בו היא כתובה המטלה הינה קלה - ולכן מצופה מנבדקים להגיב באופן תקין ובמהירות רבה יותר, אך כשיש חוסר תאימות בין הצבע לטקסט המטלה קשה יותר וזמן התגובה צפוי להתארך.

ניתן להתנסות בגרסה אינטרנטית של המטלה בקישור זה.*

https://faculty.washington.edu/chudler/java/ready.html



## יבוא וסינון


הורידו מהמודל את הטבלה "stroop_data.csv" וייבאו אותה לסביבת העבודה שלכם.

הטבלה מכילה פרטים אודות כל סבב במטלה - איזה גירוי הוצג, מה היתה התגובה של הנבדק ומה היה אורך זמן התגובה שלו (במילישניות).


האפקט שמעניין אותנו בנתונים אלו הוא ההפרש בין זמן התגובה עבור סבבים בהם הייתה תאימות בין הצבע והטקסט של הגירוי לבין שלבים בהם אלו היו שונים זה מזה.


תחילה -הדפיסו את צפו בשורות הראשונות בטבלה כדי להבין אילו עמודות קיימות בטבלה ואילו ערכים נמצאים בהן.

העמודות מתארות את מספר ההרצה (מקביל מספר נבדק), את מספר הסבב לאותו נבדק, את הגירוי שהוצג (כיתוב וצבע) ואת תגובת הנבדק (צבע שנבחר וזמן תגובה). 



כדי שנוכל לבצע את הניתוחים שלנו נצטרך לייצר שתי עמודות נוספות מתוך הנתונים הקיימים בטבלה:

  **1)** עמודת המתארת האם הנבדק צדק או טעה. עמודה זו תבחן האם התגובה של הנבדק זהה ל**צבע** של הגירוי. נקרא לעמודה זו בשם "correct".

  **2)** עמודה שתקודד האם יש התאמה בין צבע הגירוי לטקסט שמופיע בו. לעמודה זו נקראה "condition".


### סיכום ראשוני

לאחר שיצרתם את שתי העמודות הנ"ל, נוכל לבצע סיכום ראשוני של תוצאות המטלה

עבור כל נבדק חשבו את:
   כמות הסבבים שהוא ביצע
   את מספר הסבבים מתוכם בהם הצבע של הגירוי תאם לטקסט 
   ואת אחוז הסבבים בהם הנבדק הגיב נכונה (אחוז הדיוק)


```{r text_Q1, echo = FALSE}

question_text( 
  "<div style='direction: rtl;'>
מה היה אחוז הדיוק של הנבדק השני (session_id = 668587)? 
  </div>",
  answer("0.889", correct = TRUE),
  answer("0.89", correct = TRUE),
  allow_retry = TRUE
)

```


### סינון נתונים

כעת נעבור לחישוב זמן התגובה הממוצע עבור כל תנאי, עבור כל נבדק - אך לפני כן, נצטרך לסנן את הנתונים כך שלא יכללו תוצאות קיצוניות ובלתי סבירות.

תוצאות כאלו יכולות לנבוע מכך שנבדק איבד ריכוז במטלה או לקח הפסקה קצרה ואינן משקפות את זמן התגובה האמיתי של הנבדק. במידה ונשאיר את תצפיות אלו הן עלולות להטות את התוצאות שלנו באופן משמעותי - ולכן חשוב שנסנן אותן לפני חישוב הממוצעים.


כדי להבין האם יש בנתונים שלנו תצפיות קיצוניות ניעזר בהצגת זמני התגובה בהיסטוגרמה. צרו היסטוגרמה שכזהו באמצעות `ggplot`.

משהו נראה קצת מוזר?


הסיבה לכך היא שככל הנראה ישנן מספר תצפיות קיצוניות מאוד, שגורמות לתוכנה להציג את זמני התגובה על ציר מאוד רחב - כשבפועל רוב זמני התגובה מרוכזים בקצה השמאלי של הציר.

ציירו את ההיסטוגרמה שוב - אך הפעם הגבילו את ציר האיקס בין 0 ל5000.


על פי התוצאות המוצגות בטבלה, מהו לדעתכם הרף העליון הסביר לזמני התגובה?



סננו את הטבלה כך שתכיל רק זמני תגובה הקטנים מ3000 מילי שניות. נקודת חתך זו הינה קצת שרירותית. ישנן מספר דרכים לקבוע את נקודת החתך, אך כרגע נסתפק בחתך אחיד זה כדי להקל על שיחזור והשוואת תוצאות הניתוח.


```{r n_filtered, echo = FALSE}

question_text( 
  "<div style='direction: rtl;'>
כמה תצפיות סיננתם?
  </div>",
  answer("629", correct = TRUE),
  allow_retry = TRUE
)

```


בנוסף, סננו מהטבלה גם את כל הסבבים בהם הנבדקים טעו בתגובותיהם. סבבים כאלו מעידים על כך שהמטלה לא נעשתה כשורה ולכן לא נרצה לכלול את זמני התגובה של סבבים אלו בממוצעים שנחשב.


```{r are_there_NAs, echo = FALSE}

question( 
  "<div style='direction: rtl;'>
בדקו - האם הקובץ מכיל ערכים חסרים?
  </div>",
  answer("כן"),
  answer("לא", correct = TRUE),
  allow_retry = TRUE
)

```


הסינון האחרון שנערוך יכלול הסרה של כל הנתונים של נבדקים שצדקו בפחות מ50% מהסבבים. אמנם הסיכוי לצדוק בניחוש אקראי הינו נמוך יותר במקרה זה (33%), אך נוסיף לרף הדחייה שלנו מרווח נוסף עבור נבדקים שאמנם לאו דווקא ניחשו בכל סבב וסבב אך בהחלט נראה שלא ענו על המטלה בצורה טובה מספיק.

כדי לבצע את הסינון, צרו וקטור המכיל את המספר המזהה (session_id) של הנבדקים שקיבלו ציון נמוך מדי והשתמשו בו כדי לסנן את הטבלה. ניתן להפיק את הוקטור על ידי סינון הטבלה הכוללת את אחוזי המענה הנכונים עבור כל נבדק. ולשלוף את עמודת המספרים המזהים שנותרו בקובץ.


```{r n_filtered_total, echo = FALSE}

question_text( 
  "<div style='direction: rtl;'>
לאחר כל הסינונים, כמה תצפיות נותרו בקובץ?
  </div>",
  answer("201511", correct = TRUE),
  allow_retry = TRUE
)

```


### חישוב ממוצעי זמני התגובה

עכשיו שסיננו את זמני התגובה ווידאנו שהנתונים תקינים - נוכל לחשב את זמן התגובה הממוצע עבור כל נבדק בכל אחד מהתנאים.


אחרי שחישבתם את הממוצעים חשבו עבור כל נבדק את ההפרש בין ממוצע זמן התגובה בתנאי של חוסר התאמה בין המבע לטקסט - לממוצע זמן התגובה בתנאי התואם.



צרו תרשים הממחיש את פיזור ההפרשים שקיבלתם ביחס ל0.


```{r free_text_effect_direction, echo = FALSE}

question_text( 
  "<div style='direction: rtl;'>
מהתרשמותכם - האם זה נראה שנבדקים נוטים להגיב לאט יותר באחד התנאים?
  </div>",
  allow_retry = TRUE
)

```


חשבו את ממוצע ההפרשים ואת ******* טעות תקן??


```{r diff_mean, echo = FALSE}

question_text( 
  "<div style='direction: rtl;'>
מה הערך שקיבלתם?
  </div>",
  answer("-56", correct = TRUE),
  answer("56", correct = TRUE),
  answer("-56.0", correct = TRUE),
  answer("56.0", correct = TRUE),
  allow_retry = TRUE
)

```


### סיכום המטלה

צרו טבלה אחת המסכמת את תוצאות המטלה עבור כל נבדק וכוללת גם את ההפרש בזמני התגובה וגם את אחוז הטעויות. צרפו לטבלה גם את הנתונים הדמוגרפים של כל נבדק מתוך הקובץ "demographics.csv".


צרו גרף המציג את הקשר בין אחוז הטעויות לבין ההפרש בזמני התגובה.


צרו גם תרשים עמודות המציג עמודה אחת עבור זמן התגובה בתנאי התואם ועמודה נוספת עבור זמן התגובה בתנאי חוסר ההתאמה. הוסיפו לכל עמודה קווי טעות (errorbars) המייצגים את טעות התקן (SE). להזכירכם, טעות התקן מחושבת באמצעות הנוסחה הבאה:

$$ SE = \frac{SD}{\sqrt{n}} $$

לצורך הפקת התרשים תצטרכו לסכום את ממוצע זמן התגובה של הנבדקים השונים בכל תנאי (לא את זמני התגובה הגולמיים) ולחשב גם את הממוצע וגם את טעות התקן עבור זמן התגובה בכל תנאי.



## הגשה
  עברו על הקובץ וודאו שהגשתם את כל התרגילים ועניתם על כל השאלות
  
  במידה וכל התשובות שלכם תקינות יש ללחוץ על הכפתור:  Generate, להעתיק את הטקסט שמופיע בחלון למטה ולהגישו במודל  
  בהצלחה!

```{r context="server"}
learnrhash::encoder_logic()
```

```{r encode, echo=FALSE}
learnrhash::encoder_ui()
```