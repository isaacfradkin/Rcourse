---
title: "Lesson 10: Simulations" 
author: "Copyright 2024 Psychology Department. Hebrew University of Jerusalem. All rights reserved"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: false


description: >
 <div style='direction: rtl;'>
 
 </div>
       
runtime: shiny_prerendered  
editor_options: 
  markdown: 
    wrap: 72
---

```{=html}
<style>
h1, h2, h3, h4, h5, h6 {
  direction: rtl;
}
p {
  direction: rtl;
}
.text-block1 {
  direction: rtl;       /* Set text direction to right-to-left */
  text-align: right;
  background-color: #e7f3fe; /* Light grey background */
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #ddd; /* Light border */
  margin: 10px 0; /* Space around the block */
}
</style>
```

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
library(Rcourse)
library(ggplot2)
library(tidyverse)

knitr::opts_chunk$set(error = TRUE)
gradethis::gradethis_asetup()
```


## מבוא

במהלך הקורס עד כה התעסקנו רק בניתוח של נתונים אמיתיים. ביחידה זו נלמד
כישור חדש - איך ליצור נתונים על סמך סימולציה (או בעברית - הדמיה) כדי לבדוק רעיונות תיאורטיים.

הרעיון יהיה זהה בכל אחת מהדוגמאות שנפגוש ביחידה זו: 

**1.** אנחנו נניח הנחות מסוימות על המציאות (למשל - שמטבע הוא הוגן)

**2.** נבדוק מה התוצאות שהיינו מצפים לקבל בהינתן הנחות אלו (למשל - את כמות הפעמים שהגיוני שנקבל "עץ" מתוך 10 הטלות אם המטבע היה הוגן)

**3.** נשתמש במידע זה כדי לבחון האם סביר לקבל תוצאה מסויימת בהינתן אותן הנחות (למשל - האם סביר לקבל 10 "עץ" מתוך 10 הטלות)

**4.** ואם המסקנה תהיה שמאוד בלתי סביר שתוצאה כזו תתקבלה - נוכל להסיק שההנחות כנראה לא מתקיימות (והמטבע כנראה לא הוגן)



במהלך היחידה נכיר את השימוש בפונקציות הבאות:

-   `rbinom`
-   `rnorm`
-   `runif`
-   `sample`

המבצעות דגימה אקראית מתוך התפלגות.

נכיר גם הפונקציה `pnorm` המאפשרת לנו לחשב סיכויים על פי התפלגות נורמלית.


## התפלגות בינומית

### דגימה מתוך התפלגות בינומית

הסימולציה הפשוטה ביותר שנוכל לבצע כוללת הדמיה של הטלת מטבע. לפעולה זו יש
2 תוצאות אפשריות - עץ או פלי.

בR אפשר לבצע דגימה כזו באמצעות הפונקציה `rbinom`.

הפונקציה עורכת מספר הטלות מטבע ומחזירה לנו את כמות הפעמים שקיבלנו "עץ".

להלן דוגמה:

```{r coin_flip_example, exercise=TRUE, exercise.eval = FALSE}
coin_flip = rbinom(n = 1, size = 1, prob = 0.5) # פונקציה שתחזיר לנו 1 או 0, בהסתברות של 0.5

print(ifelse(coin_flip==1, "Heads","Tails") )
```

הריצו את הקוד מספר פעמים. כשקיבלנו 1 המטבע נפל על "עץ" וכשקיבנו 0 המטבע
נפל על "פלי".

במידה ונרצה לבצע הטלה של יותר ממטבע אחד נוכל לשנות את הערך של `size`
בפונקציה `rbinom`. כעת הפונקציה תחזיר לנו את מספר הפעמיים שקיבלנו "עץ"
מתוך כל ההטלות שערכנו.

```{r coin_flip_example2,  exercise=TRUE, exercise.eval = FALSE}
num_heads = rbinom(n = 1, size = 100, prob = 0.5)

print(num_heads)
```

הריצו את הקוד מספר פעמים והתרשמו מטווח הערכים שמתקבלים.

### התפלגות דגימה

במקרה הקודם בדקנו כמה פעמים קיבלו "עץ" מתוך 100 הטלות של מטבע, כשכל הרצה
של הקוד ביטאה חזרה בודדת על הדגימה הזו. כיוון שאנחנו יודעים שהתהליך
המתואר הוא אקראי, נרצה לחזור עליו מספר רב של פעמים כדי לראות מה היא
ההתפלגות של כמויות ה"עץ" שאנחנו מצפים לקבל עבור 100 הטלות מטבע. התפלגות
זו תתאר לנו את התפלגות הדגימה עבור כמויות ה"עץ" מתוך 100 הטלות עבור מטבע הוגן.

במקרה זה, נוכל ליישם את החזרות המרובות באמצעות שינוי של הערך של `n`
בפונקציה `rbinom`. כשנזין מספר גדול מ1 במקום זה נקבל חזרה וקטור של
תוצאות, כשכל ערך בוקטור מבטא חזרה נפרדת על ההטלות שביקשנו.

```{r coin_flip_sample_dist}
num_heads = rbinom(n = 50, size = 100, prob = 0.5)

print(num_heads)
```

קיבלנו וקטור באורך 50, המכילים את התוצאות מ50 חזרות, כשבכל חזרה הטלנו
100 מטבעות.

נחזור על התהליך שוב, אבל הפעם נחזור על הדגימה 10,000 פעם ונציג את
התוצאות בצורה גרפית באמצעות היסטוגרמה.

```{r coin_flip_sample_dist_2}
num_heads = rbinom(n = 10000, size = 100, prob = 0.5)

df = data.frame(num_heads = num_heads)

ggplot(df, aes(x = num_heads))+
  geom_histogram( bins = 40, fill = "lightblue", color = "black")+
  geom_vline(xintercept = 50 , color = "red", linetype = 2)

```

בגרף ניתן לראות את התוצאות שקיבלנו עבור 10000 חזרות של הטלת מטבע. ניתן
לראות שהתוצאות מתפלגות סביב הערך 50, כלומר כמות ה"עץ" שקיבלנו בממוצע
עבור 100 ההטלות הייתה סביב 50. התבוננו בתרשים שקיבלתם וענו על השאלה
הבאה:

```{r q1, echo = FALSE}
question("<div style='direction: rtl;'>
מהתרשמותכם, מה הסבירות לקבל פחות מ40 פעמים 'עץ' מתוך 100 הטלות של מטבע הוגן?
</div>",
         
         answer("כמעט וודאי", message = "אמנם היו חזרות בהן קיבלנו פחות מ40 פעמים 'עץ' אבל אילו לא היו מאוד שכיחות"),
         answer("מאוד סביר" , message = "אמנם היו חזרות בהן קיבלנו פחות מ40 פעמים 'עץ' אבל אילו לא היו מאוד שכיחות"),
         answer("מאוד לא סביר",correct = TRUE ),
         answer("כמעט בלתי אפשרי", message = "שימו לב, זו תוצאה שיצאה כמה פעמים. היא אמנם לא נפוצה, אבל היא לא מאוד נדירה" ),
         allow_retry = TRUE,
         
         
  correct="תשובה נכונה. זו תוצאה שאינה שכיחה, אך גם אינה מאוד נדירה", 
  incorrect = "נסו שוב"
)
```

למעשה, נוכל לענות על השאלה הנ"ל על ידי חישוב: נעבור על הוקטור שקיבלנו
ונבדוק כמה אחוז מהחזרות הניבו ערך קטן מ40. המספר שנקבל ישקף לנו את
הסיכוי לדגום באופן אקראי פחות מ40 פעמים "עץ" מתוך 100 הטלות מטבע.

```{r p_value_example}
num_heads = rbinom(n = 10000, size = 100, prob = 0.5)
df = data.frame(num_heads = num_heads)

p_value = sum(num_heads < 40) / 10000

ggplot(df, aes(x = num_heads))+
  geom_histogram( bins = 40, aes(fill = num_heads < 40))+
  labs(fill = "Less than 40")+
  scale_fill_manual(values = c("lightblue","pink"))

print(paste0("The probability of sampling less than 40 'heads' out of 100 coin flips of a fair coins is ", round(p_value*100),"%"))


```

### בירור ערכי סף על פי הסתברות

אנחנו יכולים גם לבצע את התהליך ההפוך - ולבדוק מה כמות הטלות ה"עץ"
שהסיכוי לקבל מספר הקטן ממנה מתאים להסתברות מסוימת, למשל - 5%.

```{r value_from_p_example}
num_heads = rbinom(n = 10000, size = 100, prob = 0.5)

df = data.frame(num_heads = num_heads)

num_heads_5_percent = quantile(num_heads, probs = 0.05) # פונקציה זו מחזירה לנו את האחוזון ה5 של וקטור התוצאות שלנו

ggplot(df, aes(x = num_heads))+
  geom_histogram( bins = 40, aes(fill = num_heads < num_heads_5_percent))+
  labs(fill = "Less than 5 percent")+
  scale_fill_manual(values = c("lightblue","pink"))

print(paste0("There is a 5% chance to get less than ",num_heads_5_percent," heads in 100 coin flips"))
```

`תרגיל`

![](images/Rstudio logo.png){width="100"}

חנה מצאה מטבע ברחוב ורצתה לבדוק אם הוא הוגן (כלומר, שהסיכוי לקבל בו "עץ"
הוא 0.5). היא הטילה את המטבע 50 פעם וקיבלה "עץ" ב20 הטלות. בדקו באמצעות
סימולציה מה הסיכוי לקבל את התוצאה שחנה קיבלה או תוצאות קיצוניות יותר (פחות מ20 הטלות "עץ") במידה והמטבע אכן היה הוגן.

פתרו את התרגיל בRstudio וענו על השאלה הבאה:

```{r q2a_hanna, echo = FALSE}

question_text(
  "<div style='direction: rtl;'>מה הסיכוי לקבל 'עץ' 20 פעמים או פחות מתוך 50 הטלות של מטבע הוגן?
  
  הזינו את הערך שקיבלתם כמספר בין 0 ל1 (למשל - 0.9 כדי לציין סיכוי של 90%) ועגלו את תשובתכם ל2 מקומות לאחר הנקודה העשרונית
  </div>",
  answer("0.1", correct = TRUE),
  answer("0.11", correct = TRUE),
  
  allow_retry = TRUE,
  correct="עבודה טובה!", 
  incorrect = "נסו שוב"
)

```

```{r q2b_hanna, echo = FALSE}
question("<div style='direction: rtl;'>
מה המשמעות של תוצאה זו?
</div>",
         
         answer("המטבע כנראה הוגן", message = "אמנם לא הוכחנו שהמטבע לא הוגן, אבל גם לא הראינו שהוא הוגן"),
         answer("לא בלתי סביר שהמטבע הוגן",correct = TRUE),
         answer("המטבע אינו הוגן",  message = "לא הראינו שהוא אינו הוגן. להפך - נראה שלא מאוד נדיר לקבל תוצאות כאלו אפילו אם המטבע הוגן"),
         answer("לא למדנו דבר על ההוגנות של המטבע", message = "אמנם לא הגענו למסקנה חותכת, אבל אנחנו כן יודעים על המטבע יותר משידענו לפני ההטלות " ),
         allow_retry = TRUE,
         
         
  correct="תשובה נכונה. הסיכוי לקבל תוצאה כזו אם המטבע היה הוגן היא אמנם לא מאוד גבוה, אבל גם לא נמוך במיוחד. כלומר - בהחלט הגיוני שהמטבע כן הוגן. לא הוכחנו זאת, אבל התוצאות גם לא הובילו אותנו לשלול את האפשרות הזו"
)
```


## התפלגות נורמלית

רוב המדדים שאנחנו מתעניינים בהם בפסיכולוגיה אינם דיכוטומיים, אלא רציפים.
רבים מתוכם מתפלגים באופן נורמלי או קרוב לנורמלי באוכלוסייה, ולכן מאוד
שימושי לבצע סימולציות שמערבות דגימה מהתפלגות נורמלית.

הפונקציה שתשמש אותנו במקרים כאלו הינה `rnorm` שמקבלת 3 ערכים: מספר
הדגימות, ממוצע וס"ת.

```{r normal_example}
one_sample = rnorm(n = 1, mean = 8, sd = 2)

many_samples = rnorm(n = 100, mean = 8, sd = 2)

```

נוכל להשתמש בפונקציה זו כדי לבצע הדמיות שעונות על שאלות דומות לאלו
שפגשנו סביב הטלת מטבע. למשל:

מה הסיכוי לדגום באקראי אדם בגובה 140 ס"מ ומטה מתוך אוכלוסיה בה הגבהים
מתפלגים נורמלית עם ממוצע 150 וס"ת 10?

`תרגיל` השלימו את הקוד הבא כדי לענות על השאלה הנ"ל:

```{r ex1_normal_p_value, rexercise=TRUE, exercise.eval = FALSE}
population_distribution = rnorm(_______________)

height = 140
p_sample_140_or_under = mean(population_distribution<= height)

print(paste0("The chance of sampling a person with a height of ",height," or greater is ", round(p_sample_140_or_under *100),"%"))

```

למעשה, במקרה הזה ישנה פונקציה שמאפשרת לנו לעשות את הבדיקה הזו בצורה
ישירה יותר, מבלי להידרש לדגימה.

פונקציה זו נקראת `pnorm` והיא בוחנת את הסיכוי לקבל ערך נמוך מערך מסוים
מתוך התפלגות נורמלית עם ממוצע וס"ת נתונים. למשל, אתה התוצאה מהתרגיל
האחרון יכולנו לחשב כך:

```{r pnorm_example}
p_sample_140_or_under  = pnorm(140, mean = 150, sd = 10)

print(paste0("The chance of sampling a person with a height of ",height," or greater is ", round(p_sample_140_or_under *100),"%"))

```


### התפלגות דגימה

נניח שאנחנו לא מתעניינים באדם אחד, אלא בממוצע של קבוצת אנשים. במקרים
כאלו נוכל להשתמש בפונקציה `rnorm` כדי לאסוף מדגם, שממנו נוכל להפיק
ממוצע. נוכל לחזור על התהליך שוב ושוב באמצעות לולאה, כל פעם עם מדגם אחר
ולחשב כך את התפלגות הדגימה של הממוצע - התפלגות הממוצעים שאנחנו מצפים
לקבל כשאנחנו דוגמים מדגם בגודל מסויים מתוך האוכלוסייה הזו.

נוכל להשתמש בסימולציה כזו כדי לענות על שאלות כמו:

אם היינו דוגמים מדגם של 20 אנשים מתוך אוכלוסייה ששעות השינה בה מתפלגות
נורמלית עם ממוצע 8 וס"ת 2, מה היה הסיכוי לקבל מדגם בודד (גם הוא בן 20
נבדקים) בו הממוצע הוא פחות מ7?

הקוד יראה כך:

```{r norm_sampling_dist_example}
iterations = 1000 # מספר החזרות של ההדמיה

means = c()       # וקטור ריק לטובת שמירת הממוצעים
for (i in 1:iterations){
  sample = rnorm(n = 20, mean = 8, sd = 2)
  sample_mean = mean(sample)
  means = c(means, sample_mean)
}

p_value_less_than_7 = sum(means < 7) / iterations

print(paste0("The probability of randomly sampling a sample of size 20 with a mean less than 7 from this population is: ", p_value_less_than_7*100," %"))

ggplot(data.frame(means), aes(x = means)) +
  geom_histogram(bins = 30, fill = "lightblue", color = "black")+
  geom_vline(xintercept = 7, color = "red", linetype = 2)
             
```

ניתוח כזה מאפשר לנו לבדוק עד כמה סביר שמדגם כלשהו הגיע
מאוכלוסיה עם ממוצע וס"ת נתונים. אם נקבל ממוצע שמאוד בלתי סביר לקבל
בדגימה מתוך האוכלוסייה שבדקנו - נוכל להסיק שהמדגם שלנו ככל
הנראה לא הגיע מאוכלוסייה זו.

`תרגיל`

אספתם באופן אקראי מדגם של ציוני שמחת החיים עבור 30 אנשים. בדקו מה
הסיכויים לקבל מדגם בעל ממוצע הזהה לממוצע שהתקבל ממדגם זה מתוך האוכלוסייה
של מדינה בה ציוני שמחת החיים מתפלגים נורמלית עם ממוצע 3.5 וס"ת 1.

```{r ex2_sampling_dist_normal, exercise=TRUE, exercise.eval = FALSE}
happiness = c(3.9, 2.2, 3.4, 2.4, 2.6, 2.7,5.7, 2.9, 2.9, 3.8
              1.1, 2.3, 0.8, 2.5, 2.9, 3, 2.8, 2.6, 0.2, 2.6,
              1.6, 1.6, 3.2, 3.7, 5,2.8, 2.7, 2.3, 2.2, 2.4)





```

```{r ex2_sampling_dist_normal-solution}
happiness = c(3.9, 5, 3.5, 2.5, 2.6, 4.2, 5, 2.9, 2.9, 3.8,
              4.1, 2.5, 4.5, 2.5, 2.9, 3, 4.5, 2.6, 2.6, 3.9,
              3.2, 3.5, 3.4, 3.9, 5,4.1, 2.7, 2.3, 3.8, 2.4)

iterations = 1000 # מספר החזרות של ההדמיה

means = c()       # וקטור ריק לטובת שמירת הממוצעים
for (i in 1:iterations){
  sample = rnorm(n = 30, mean = 3.5, sd = 1)
  sample_mean = mean(sample)
  means = c(means, sample_mean)
}

p_value_less_than_3.5 = sum(means < mean(happiness)) / iterations

print(paste0("The probability of randomly sampling a sample of size 30 with a mean less than 3.5 from this population is: ", p_value_less_than_3.5*100," %"))

ggplot(data.frame(means), aes(x = means)) +
  geom_histogram(bins = 30, fill = "lightblue", color = "black")+
  geom_vline(xintercept = mean(happiness), color = "red", linetype = 2)

```

```{r q3_sampling_dist_normal, echo = FALSE}

question(
  "<div style='direction: rtl;'
   מה הסיכוי לדגום מתוך האוכלוסייה של מדינה זו מדגם בגודל 30 בו ממוצע שמחת החיים יהיה זהה למדגם או נמוך ממנו?
  </div>",
  answer("40%", correct = TRUE),
  answer("20%"),
  answer("10%"),
  answer("5%"),
  allow_retry = TRUE,
  
           
  correct="כלומר - ממש לא בלתי סביר שהמדגם הגיע מאוכלוסייה זו. יפה מאוד!", 
  incorrect = "נסו שוב"
)

```


#### פתרון אנליטי

גם את השאלות הנוגעות להתפלגות דגימה אנחנו יכולים לפתור ללא
סימולציה - שכן התפלגויות הדגימה של הממוצע של מדגם המתפלג נורמלית מתנהגות
בהתאם לכללים מוגדרים, אותם למדתם בשיעור סטטיסטיקה.

אנחנו יודעים שהתפלגות הדגימה של ממוצע המדגמים שנדמו מאוכלוסייה נורמלית תהיה גם היא נורמלית, עם תוחלת הזהה לתוחלת
ההתפלגות של הערכים באוכלוסייה וטעות תקן (סטיית התקן של התפלגות
הדגימה) השווה לסטיית התקן באוכלוסייה חלקי שורש גודל המדגם:

$$\sigma/\sqrt n$$

להמחשה, לפניכם השוואה בין ההתפלגות שמתקבלת מתוך סימולציה של התפלגות הדגימה אל מול
התפלגות הדגימה התיאורטית שמתקבלת מתוך הכללים הנ"ל:

```{r analytic_solution_example}
iterations = 1000 # מספר החזרות של ההדמיה

n = 20  # הנתונים עבור הסימולציה
mean = 8
sd = 2

means = c()       # וקטור ריק לטובת שמירת הממוצעים
for (i in 1:iterations){      # ביצוע סימולציה של התפלגות דגימה
  sample = rnorm(n = n, mean = mean, sd = sd)
  sample_mean = mean(sample)
  means = c(means, sample_mean)
}

se = sd/ sqrt(n)  # חישוב טעות התקן

ggplot(data.frame(means), aes(x = means)) +
  geom_histogram(aes(y = ..density..), bins = 30, fill = "lightblue", color = "black",)+  # התפלגות דגימה על סמך סימולציה
  geom_function(fun = dnorm, args = list(mean = mean, sd = se), color = "red", size = 1)  # התפלגות דגימה - פתרון אנליטי

```


### דגימה מאוכלוסייה שאינה נורמלית

כל הסימולציות שעשינו עד כה עונות על שאלות שיכולנו לפתור גם באופן
אנליטי. הן אמנם עושות זאת באופן ברור יותר ומעט יותר אינטואיטיבי, אבל הן
מפיקות תוצאה זהה למבחנים האנליטיים הקיימים. עם זאת, ההדמיות מאפשרות לנו
לבדוק בקלות גם שאלות שאין להן פתרון אנליטי יודע, או שיש להן פתרון - אבל
הוא מורכב ולא נלמד בקורסי הסטטיסטיקה שלקחנו.

דוגמא אחת שכזו היא מצב בו המדד שאנחנו מתעניינים בו מתפלג באופן שאינו
נורמלי (גם לא בקירוב). למשל - כשהוא מתפלג באוכלוסייה באופן אחיד.

כדי לדגום מתוך התפלגויות שאינן נורמליות נוכל להיעזר בפונקציות כדוגמת
`runif` (התפלגות אחידה), `rexp` (התפלגות מעריכית) או פונקציות נוספות
המאפשרות לנו לדגום מתוך התפלגויות אחרות.


#### דגימה מהתפלגות אחידה

`תרגיל` 
![](images/Rstudio logo.png){width="100"}

ידוע שהאורך של שקדי מרק במפעל מסוים מתפלג **באופן אחיד** בין 0.5-1.5 ס"מ.
מה הסיכוי שנדגום באקראי 10 שקדים עם אורך ממוצע של 0.8 ס"מ ומטה?

היעזרו בפקודה `runif` המשמשת באופן הבא:

```{r runif_example}
# דוגמה לדגימת 30 תצפיות מהתפלגות אחידה בין הערכים 1 ו2א
sample_vec = runif(n = 30, min = 1, max = 2 )
```

פתרו את התרגיל בRstudio וענו על השאלה הבאה:

```{r q4_uniform, echo = FALSE}

question_text(
  "<div style='direction: rtl;'>
  מה הסיכוי שנדגום באקראי 10 שקדים עם אורך ממוצע של 0.8 סנטימטר ומטה?
    
  הזינו את הערך שקיבלתם כמספר בין 0 ל1 (למשל - 0.9 כדי לציין סיכוי של 90%) ועגלו את תשובתכם ל2 מקומות לאחר הנקודה העשרונית
  </div>",
  answer("0.01", correct = TRUE),
  answer("0.02", correct = TRUE),
  allow_retry = TRUE,
  
           
  correct="מעולה!", 
  incorrect = "נסו שוב"
)

```


### דגימה מתוך וקטור

סוג התפלגות הדגימה האחרון שנשתמש בו בפרק זה נוגע לדגימה מתוך וקטור. כאן
אנחנו נספק את הערכים האפשריים ונבצע מתוכם דגימה באקראי. לצורך כך נשתמש
בפונקציה `sample`.

לדוגמה, אם נרצה לדגום באקראי 3 הטלות קובייה נוכל לעשות זאת בצורה הבאה:

```{r sample_example}
three_rolls = sample(x= 1:6,      # וקטור המכיל את המספרים בין 1 ל6
                     size = 3,    # כמות הדגימות שנרצה לדגום
                     replace = T) # משתנה השולט בהאם הדגימה תהיה עם או ללא החזרה
                                  # במידה ונדגום ללא החזרה - לא נוכל לקבל פעמיים את
print(three_rolls)                # אותה התוצאה, ולכן ביקשנו כאן דגימה עם החזרה
```

`תרגיל`

![](images/Rstudio logo.png){width="100"}

בנו התפלגות דגימה עבור הערך המקסימלי מתוך הטלה של ארבעה קוביות

היעזרו בפונציה `max` כדי לחלץ מתוך וקטור את הערך המקסימלי 


```{r q5_sampling_from_vector}
question_text(
  "<div style='direction: rtl;'>
  מה הסיכוי שהערך המקסימלי מתוך ארבעה ההטלות יהיה קטן מ3?
  
  הזינו את הערך שקיבלתם כמספר בין 0 ל1 (למשל - 0.9 כדי לציין סיכוי של 90%) ועגלו את תשובתכם ל2 מקומות לאחר הנקודה העשרונית
  </div>",
  answer("0.01", correct = TRUE),
  answer("0.02", correct = TRUE),
  allow_retry = TRUE,
  
           
  correct="מעולה!", 
  incorrect = "נסו שוב"
)


```

## מבחני עוצמה

שימוש נוסף, ואחרון עבור יחידה זו, לסימולציות משמש אותנו לחישוב עוצמת
מבחן.

כפי שלמדתם בשיעור סטטיסטיקה, עוצמת מובחן מוגדרת בתור הסיכוי לקבל תוצאה
מובהקת בניסוי שאנחנו מריצים, בהנחה והאפקט שאותו אנחנו מחפשים אכן קיים.
אנחנו נרצה לחשב אותה לפני שנריץ את הניסוי כדי לראות שגודל המדגם בחרנו
להריץ גדול מספיק כדי לספק לנו סיכוי טוב למצוא את האפקט.

אופן החישוב יעשה לפי השלבים הבאים:

1)  הגדרת האוכלוסייה ממנו אנחנו דוגמים, בהנחה והאפקט שאנחנו מחפשים אכן
    קיים.
2)  דגימה של מדגם בגודל שזהה לגודל המדגם שאנחנו מתכננים לאסוף
3)  ביצוע המבחן הסטטיסטי המתוכנן על המדגם שקיבלנו
4)  שמירת תוצאות המבחן.

נחזור על שלבים 2-4 מספר רב של פעמים והקבל התפלגות של תוצאות הניסוי
הצפויות. נחשב את הסיכוי לקבל תוצאה מובהקת ונקבל את עוצמת המבחן.

### מבחן Z

נדגים את התהליך על ניסוי הנשען על מבחן Z למדגם יחיד. מבחן זה מתאים
למצבים בהם אנחנו רוצים לבחון האם המדגם שאספנו שייך לאוכלוסייה עם ממוצע
וס"ת נתונים.

למשל: האם אנשים שלומדים פסיכולוגיה נמוכים יותר בתכונת הנוירוטיות ביחס
לאוכלוסיית הסטודנטים הכללית, בהינתן וידוע שבקרב כלל הסטודנטים תכונה זו
מתפלגת נורמלית עם ממוצע 3 וס"ת 1.

כדי לבצע את המבחן נוכל להשתמש בפונקציה `pnorm` שהכרנו מוקדם יותר ביחידה,
ומחזירה את הסיכוי לקבל תוצאה קטנה או שווה לערך מסוים מתוך התפלגות
נורמלית. את הסיכוי שנקבל נשווה לערך האלפא שנקבע מראש - רף הדחייה, שבדרך
כלל מוגדר כ5%. כלומר, אם הסיכוי לקבל את

עבור חזרה אחת, המבחן יערך בצורה הבאה:

```{r z_test_example}
# נניח ואספנו מדגם של 30 סטודנטים וקיבלנו עבורם ציון נוירוטיות ממוצע של 3.5
score = 2.5
sample_size = 30

p_value = pnorm(score , mean = 3, sd = 1/sqrt(sample_size))
print(p_value)
```

כיוון שאנחנו רוצים לדעת מה התוצאות שאנחנו צפויים לקבל אם ממוצע הנעימות
של תלמידי פסיכולוגיה הוא אכן גבוהה יותר - נחזור על המבחן הנ"ל עבור
ממוצעים שנדגמו מההתפלגות שאנחנו חושבים שמתארת את הציונים של תלמידי
פסיכולוגיה. בדוגמה זו נניח שהציונים שלהם מתפלגים נורמלית עם תוחלת 3.5
וס"ת 1.\
\
נחזור על המבחן הנ"ל עבור 1000 מדגמים ונבדוק בכמה מהמקרים קיבלנו תוצאה
מובהקת סטטיסטית.

```{r power_example}
sample_size = 30

p_values = c()

for (i in 1:1000){
  sampled_N = rnorm(sample_size, mean = 2.5, sd = 1)
  sample_mean = mean(sampled_N)
  
  p_value = pnorm(sample_mean, mean = 3, sd = 1/sqrt(sample_size))
  p_values = c(p_values, p_value)
}

percent_significant = mean(p_values < 0.05)

print(paste0("Power = ",round(percent_significant,2)))


```

כלומר - אם המצב בעולם הוא שתכונת הנוירוטיות אצל סטודנטים לפסיכולוגיה אכן
מתפלגת נורמלית עם ממוצע 2.5 וס"ת 1, אז
ב`r round(percent_significant*100)` אחוז מהמקרים מדגם בגודל 30 יניב
תוצאות מובהקות סטטיסטית ויראה שהם אכן נמוכים יותר בתכונה זו מאוכלוסיית
הסטודנטים הכללית.

### תרגיל

![](images/Rstudio logo.png){width="100"}

`תרגיל` בצעו ניתוח עוצמה למקרה הבא
  
חוקר מעוניין לבחון האם החתולים בקמפוס חמודים יותר מחתולים בשאר העיר.
מכיוון שידוע שציוני החמידות של חתולים בירושלים מתפלגים נורמלית עם תוחלת
6 וס"ת 1.5, הוא מתכנן לאסוף מדגם של חתולים בקמפוס ולהשוות את הממוצע שלהם
להתפלגות הדגימה של אוכלוסייה זו.
  
בהינתן וציוני החמידות של החתולים **בקמפוס** מתפלגים נורמלית עם תוחלת 6.5
וס"ת 1.5 - מה הסיכוי שמדגם של 40 חתולים יספיק לחוקר כדי לקבל תוצאות מובהקות
סטטיסטית?\

הערה: שימו לב שההשוואה שעורך החוקר בודקת אם החתולים בקמפוס חמודים
**יותר** אילו ערך הp value שמתקבל מהפונקציה `pnorm` בוחן את הסיכויים
לקבל ערך **נמוך** יותר - ולכן צריך לחשב את הערך המשלים ל1 לערך שהתקבל.
למשל אם התקבל הערך 0.975, ערך הp value המתאים הינו 0.025.

פתרו את התרגיל בRstudio וענו על השאלה הבאה:


```{r q6_power, echo = FALSE}

question_text(
  "<div style='direction: rtl;'>
  מה תהיה עוצמת המבחן עבור ניסוי שכולל מדגם בגודל 40?
  
  הזינו את הערך שקיבלתם כמספר בין 0 ל1 (למשל - 0.9 כדי לציין עוצמה של 90%) ועגלו את תשובתכם ל2 מקומות לאחר הנקודה העשרונית
  </div>",
  answer("0.7", correct = TRUE),
  answer("0.70", correct = TRUE),
  answer("0.69", correct = TRUE),
  answer("0.68", correct = TRUE),
  answer("0.67", correct = TRUE),
  allow_retry = TRUE,
  
           
  correct="מעולה!", 
  incorrect = "נסו שוב"
)

```

## הגשה

עברו על הקובץ וודאו שהגשתם את כל התרגילים ועניתם על כל השאלות

במידה וכל התשובות שלכם תקינות יש ללחוץ על הכפתור: Generate, להעתיק את
הטקסט שמופיע בחלון למטה ולהגישו במודל\
בהצלחה!

```{r context="server"}
learnrhash::encoder_logic()
```

```{r encode, echo=FALSE}
learnrhash::encoder_ui()
```
